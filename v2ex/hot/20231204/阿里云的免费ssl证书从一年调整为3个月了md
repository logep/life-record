### 阿里云的免费 ssl 证书从一年调整为 3 个月了

> 尊敬的阿里云用户：
接收到厂商关于免费证书服务收费策略调整的通知，我们将在 2023 年 11 月 14 号开始生效厂商策略。在策略生效后，免费证书规则如下：
>
>对于免费领取的 SSL 证书，签发后的证书有效期统一变更为 3 个月。如果您希望继续使用 12 个月有效期的免费证书，则需收取相关服务费，费用为 68 元/张/年。

公告地址: https://help.aliyun.com/zh/ssl-certificate/product-overview/notice-on-adjustment-of-service-policies-for-free-certificates?spm=0.2020520163.0.0.566d3711ti6KpN

请教各位大佬, 如果是阿里云的 ssl 免费证书 如何做到自动续期?

或者其他的免费证书呢?

---------------------------------------------------

可以使用 https://github.com/acmesh-official/acme.sh

---------------------------------------------------

@yuwangG 微信不认  letsencrypt 证书

---------------------------------------------------

@veike 那就用 freessl ，国内的证书微信肯定认。

---------------------------------------------------

腾讯云的,可以吗

---------------------------------------------------

开始收割了

---------------------------------------------------

freessl 也改了

---------------------------------------------------

我开始用 cloudflare 管理我的域名了，好像是免费的 ssl 证书

---------------------------------------------------

全都是这样。西部数码的也是调整为 3 个月了。估计是提供商“亚洲诚信”调整策略了。

---------------------------------------------------

@veike 刚看了一下，认的

---------------------------------------------------

个人用的全都换 acme 了，支持泛域名。

再也不用在服务器上放一堆证书，过段时间还要一个个手动申请更新证书

---------------------------------------------------

直接 traefik ，国内不怕打的话腾讯云 cdn 自动续

---------------------------------------------------

ssl 证书就是新时代的互联网收租。

---------------------------------------------------

@zzerd 腾讯云 cdn 不也是要自己上传证书的嘛

---------------------------------------------------

@veike 有文档说不认么？几年前干小程序的时候还认的

---------------------------------------------------

acme 的 zerossl 挺好的，免费自动续签，完全无感

---------------------------------------------------

唉。。。

---------------------------------------------------

CF 使用严格模式，源站和 CF 使用 15 年的自签证书，CF 自动管理和浏览器的证书。省心。

---------------------------------------------------

@veike 请问微信不认 letsencrypt 证书这个说法出处是哪里呢? 这个我在生产环境用了 5 年多了, 不论是微信 H5 页面还是小程序访问都没问题

---------------------------------------------------

韭菜们，秋收的季节到了。

---------------------------------------------------

腾讯云的一年啊

---------------------------------------------------

@billzhuang 不用腾讯云那个是到期自动申请

---------------------------------------------------

acme.sh 可以供 google public ca 呀

---------------------------------------------------

@veike 认啊，一直用的 letsencrypt

---------------------------------------------------

@veike 微信小程序里面 letsencrypt 证书的 https 网址可以用

---------------------------------------------------

acme.sh

---------------------------------------------------

acme.sh 有些东西看不懂，我打算换宝塔了，三个月自动续。

---------------------------------------------------

caddy + letsencrypt 真香。

---------------------------------------------------

一直在用 letsencrypt 证书，没发现微信里头有问题

---------------------------------------------------

@NessajCN 
@lifei6671 
@NessajCN 
@chendy 
@Foxkeh 
@default 
之前小程序遇到过 let's encrypt 不认的情况，换了其他的 ssl 就好了，微信社区也看到过这个问题，不太确认什么情况下不认这个证书。

---------------------------------------------------

caddy +1

---------------------------------------------------

因为这个，我现在在找个合适的 github actions 来帮我更新证书，有见识广个大佬推荐的好用的嘛😭

---------------------------------------------------

@veike 那就只能盲猜配了单证书没配证书链了，属于开发自己的问题不是证书的问题

---------------------------------------------------

Let' Encrypt 确实兼容性会差一点，尤其是取消交叉认证以后
https://letsencrypt.org/zh-cn/docs/certificate-compatibility/

---------------------------------------------------

用的 acme 谷歌的证书，3 个月自动续期，然后执行 php 传输到腾讯云的 ssl


\cp -rf /www/server/panel/vhost/cert/a.com/fullchain.pem /www/server/panel/ssl/certificate.pem
\cp -rf /www/server/panel/vhost/cert/a.com/privkey.pem /www/server/panel/ssl/privateKey.pem
bt restart
nginx -s reload
/www/server/php/74/bin/php /www/wwwroot/b.com/public/index.php

index.php:
try {

            $cred = new Credential($SecretId, $SecretKey);
            $httpProfile = new HttpProfile();
            $httpProfile->setEndpoint("ssl.tencentcloudapi.com");
            $clientProfile = new ClientProfile();
            $clientProfile->setHttpProfile($httpProfile);
            $client = new SslClient($cred, "", $clientProfile);
            $req = new UploadCertificateRequest();
            $params = array(
                "CertificatePublicKey" => file_get_contents($zhengshu_crt),
                "CertificatePrivateKey" => file_get_contents($zhengshu_key),
                "Alias" => 'PHPAUTO'.date('YMDHis'),
                "CertificateUse" => "CDN"
            );
            $req->fromJsonString(json_encode($params));
            $resp = $client->UploadCertificate($req);
            $resp_json=json_decode($resp->toJsonString(),true);
            if(!isset($resp_json['CertificateId'])){
                throw new Exception("上传证书错误，没有获取到证书 id");
            }
            $httpProfilecdn = new HttpProfile();
            $httpProfilecdn->setEndpoint("cdn.tencentcloudapi.com");
            $clientProfilecdn = new ClientProfile();
            $clientProfilecdn->setHttpProfile($httpProfilecdn);
            $clientcdn = new CdnClient($cred, "", $clientProfilecdn);

            $reqcdn = new UpdateDomainConfigRequest();
            foreach ($add_domain as $v){
                $paramscdn = array(
                    "Domain" => $v,
                    "Https" => array(
                        "Switch" => "on",
                        "CertInfo" => array(
                            "CertId" => $resp_json['CertificateId']
                        )
                    )
                );
                $reqcdn->fromJsonString(json_encode($paramscdn));
                $respcdn = $clientcdn->UpdateDomainConfig($reqcdn);
                echo $respcdn->toJsonString().'\n';
                sleep(1);
            }
            
        }
        catch(TencentCloudSDKException $e) {
            echo $e;
        }

---------------------------------------------------

用腾讯云里免费的

---------------------------------------------------

搜了一下，5 年前不支持 Let' Encrypt ，当时能说得过去。

现在都 5 年后了还不支持，就很说不过去了，要做就好好做嘛。

---------------------------------------------------

看了下：
阿里云华为云都是 3 个月，他们的上游供应商是 DigiCert.(看上去 DigiCert 调整了策略)
https://help.aliyun.com/zh/ssl-certificate/product-overview/notice-on-adjustment-of-service-policies-for-free-certificates
https://www.huaweicloud.com/notice/2022/20231012174226239.html

腾讯云的免费 SSL 证书上游供应商是 TrustAsia.（看上去 TrustAsia 没调整策略，是 1 年）

---------------------------------------------------

刚测试了一下，腾讯云的免费 ssl 还是可以 1 年。

---------------------------------------------------

又拍云的 DigiCert 还是一年

---------------------------------------------------

@veike #2 请确认清楚再说，会误导别人的，我的小程序就是用 acme 的 letsencrypt,没什么问题

---------------------------------------------------

@veike 


瞎说，我用 let's 快 10 年了，小程序公众号啥都没问题。

---------------------------------------------------

@veike 

let's 有段时间出问题是因为以前的 root 证书过期了。。。后来换了一个证书，为了兼容采用双 root ，
然后微信支付官方 c++库比较老，估计不认双 root ，所以会出现问题，后来我提了 bug---大概 2 年前左右。。。
这两年没啥问题。。。

---------------------------------------------------

我也遇到这个问题了，然后发现申请历史里面有个去年的申请扔那没管，用去年的那个申请提交了一下，还是 1 年的期限。

---------------------------------------------------

@encro 21 年 9 月份，我的邮箱服务器国庆期间自动更新证书，炸了，记忆犹新。

---------------------------------------------------

换成 caddy 了，省心省力

---------------------------------------------------

@veike #2 不会吧，我一直用没问题的

---------------------------------------------------

这种中国人企业的“证书”你们也敢用阿？不怕总参三部随便拿到吗？

---------------------------------------------------

@FightPig 我也是

---------------------------------------------------

@salmon5 TrustAsia 也要修改了，到时候都会一起变的
https://www.trustasia.com/view-free-ssl-one-year-adjustment-announcement/

---------------------------------------------------

@Foxkeh 最早的 acme 生成证书只有 cert 文件前面两部分，而完整证书需要三部分。那时候浏览器访问是没问题的，但是微信小程序认为证书不全不认 https ，需要手动生成补全才能用。后来不知道什么时候 acme 改了可以选择生成完整证书，再后来默认证书就是完整三部分。大概是这个原因

---------------------------------------------------

acme 不要太方便

---------------------------------------------------

https://www.cloudflare.com/ 、acme 、freessl 不香吗？非要去搞阿里云的。

---------------------------------------------------

acme 或者 cloud flare 申请 GTS

---------------------------------------------------

@veike 腾讯云也有免费证书

---------------------------------------------------

七牛云的 TustAsian 还是 1 年

---------------------------------------------------

let's 的挺好用呀，搞个 crontab ，certbot 一条简短的命令就搞定了证书更新。

---------------------------------------------------

3 个月, 那我还不如用 let's encrypt 了. 还能自动续租.

---------------------------------------------------

@veike 


瞎说，我用 let's 快 10 年了，小程序公众号啥都没问题。

---------------------------------------------------

@veike 

let's 有段时间出问题是因为以前的 root 证书过期了。。。后来换了一个证书，为了兼容采用双 root ，
然后微信支付官方 c++库比较老，估计不认双 root ，所以会出现问题，后来我提了 bug---大概 2 年前左右。。。
这两年没啥问题。。。

---------------------------------------------------

我也遇到这个问题了，然后发现申请历史里面有个去年的申请扔那没管，用去年的那个申请提交了一下，还是 1 年的期限。

---------------------------------------------------

@encro 21 年 9 月份，我的邮箱服务器国庆期间自动更新证书，炸了，记忆犹新。

---------------------------------------------------

换成 caddy 了，省心省力

---------------------------------------------------

@veike #2 不会吧，我一直用没问题的

---------------------------------------------------

这种中国人企业的“证书”你们也敢用阿？不怕总参三部随便拿到吗？

---------------------------------------------------

@FightPig 我也是

---------------------------------------------------

@salmon5 TrustAsia 也要修改了，到时候都会一起变的
https://www.trustasia.com/view-free-ssl-one-year-adjustment-announcement/

---------------------------------------------------

@Foxkeh 最早的 acme 生成证书只有 cert 文件前面两部分，而完整证书需要三部分。那时候浏览器访问是没问题的，但是微信小程序认为证书不全不认 https ，需要手动生成补全才能用。后来不知道什么时候 acme 改了可以选择生成完整证书，再后来默认证书就是完整三部分。大概是这个原因

---------------------------------------------------

acme 不要太方便

---------------------------------------------------

https://www.cloudflare.com/ 、acme 、freessl 不香吗？非要去搞阿里云的。

---------------------------------------------------

acme 或者 cloud flare 申请 GTS

---------------------------------------------------

@veike 腾讯云也有免费证书

---------------------------------------------------

七牛云的 TustAsian 还是 1 年

---------------------------------------------------

let's 的挺好用呀，搞个 crontab ，certbot 一条简短的命令就搞定了证书更新。

---------------------------------------------------

3 个月, 那我还不如用 let's encrypt 了. 还能自动续租.

---------------------------------------------------

@veike 


瞎说，我用 let's 快 10 年了，小程序公众号啥都没问题。

---------------------------------------------------

@veike 

let's 有段时间出问题是因为以前的 root 证书过期了。。。后来换了一个证书，为了兼容采用双 root ，
然后微信支付官方 c++库比较老，估计不认双 root ，所以会出现问题，后来我提了 bug---大概 2 年前左右。。。
这两年没啥问题。。。

---------------------------------------------------

我也遇到这个问题了，然后发现申请历史里面有个去年的申请扔那没管，用去年的那个申请提交了一下，还是 1 年的期限。

---------------------------------------------------

@encro 21 年 9 月份，我的邮箱服务器国庆期间自动更新证书，炸了，记忆犹新。

---------------------------------------------------

换成 caddy 了，省心省力

---------------------------------------------------

@veike #2 不会吧，我一直用没问题的

---------------------------------------------------

这种中国人企业的“证书”你们也敢用阿？不怕总参三部随便拿到吗？

---------------------------------------------------

@FightPig 我也是

---------------------------------------------------

@salmon5 TrustAsia 也要修改了，到时候都会一起变的
https://www.trustasia.com/view-free-ssl-one-year-adjustment-announcement/

---------------------------------------------------

@Foxkeh 最早的 acme 生成证书只有 cert 文件前面两部分，而完整证书需要三部分。那时候浏览器访问是没问题的，但是微信小程序认为证书不全不认 https ，需要手动生成补全才能用。后来不知道什么时候 acme 改了可以选择生成完整证书，再后来默认证书就是完整三部分。大概是这个原因

---------------------------------------------------

acme 不要太方便

---------------------------------------------------

https://www.cloudflare.com/ 、acme 、freessl 不香吗？非要去搞阿里云的。

---------------------------------------------------

acme 或者 cloud flare 申请 GTS

---------------------------------------------------

@veike 腾讯云也有免费证书

---------------------------------------------------

七牛云的 TustAsian 还是 1 年

---------------------------------------------------

let's 的挺好用呀，搞个 crontab ，certbot 一条简短的命令就搞定了证书更新。

---------------------------------------------------

3 个月, 那我还不如用 let's encrypt 了. 还能自动续租.

---------------------------------------------------

@veike 


瞎说，我用 let's 快 10 年了，小程序公众号啥都没问题。

---------------------------------------------------

@veike 

let's 有段时间出问题是因为以前的 root 证书过期了。。。后来换了一个证书，为了兼容采用双 root ，
然后微信支付官方 c++库比较老，估计不认双 root ，所以会出现问题，后来我提了 bug---大概 2 年前左右。。。
这两年没啥问题。。。

---------------------------------------------------

我也遇到这个问题了，然后发现申请历史里面有个去年的申请扔那没管，用去年的那个申请提交了一下，还是 1 年的期限。

---------------------------------------------------

@encro 21 年 9 月份，我的邮箱服务器国庆期间自动更新证书，炸了，记忆犹新。

---------------------------------------------------

换成 caddy 了，省心省力

---------------------------------------------------

@veike #2 不会吧，我一直用没问题的

---------------------------------------------------

这种中国人企业的“证书”你们也敢用阿？不怕总参三部随便拿到吗？

---------------------------------------------------

@FightPig 我也是

---------------------------------------------------

@salmon5 TrustAsia 也要修改了，到时候都会一起变的
https://www.trustasia.com/view-free-ssl-one-year-adjustment-announcement/

---------------------------------------------------

@Foxkeh 最早的 acme 生成证书只有 cert 文件前面两部分，而完整证书需要三部分。那时候浏览器访问是没问题的，但是微信小程序认为证书不全不认 https ，需要手动生成补全才能用。后来不知道什么时候 acme 改了可以选择生成完整证书，再后来默认证书就是完整三部分。大概是这个原因

---------------------------------------------------

acme 不要太方便

---------------------------------------------------

https://www.cloudflare.com/ 、acme 、freessl 不香吗？非要去搞阿里云的。

---------------------------------------------------

acme 或者 cloud flare 申请 GTS

---------------------------------------------------

@veike 腾讯云也有免费证书

---------------------------------------------------

七牛云的 TustAsian 还是 1 年

---------------------------------------------------

let's 的挺好用呀，搞个 crontab ，certbot 一条简短的命令就搞定了证书更新。

---------------------------------------------------

3 个月, 那我还不如用 let's encrypt 了. 还能自动续租.

---------------------------------------------------

@veike 


瞎说，我用 let's 快 10 年了，小程序公众号啥都没问题。

---------------------------------------------------

@veike 

let's 有段时间出问题是因为以前的 root 证书过期了。。。后来换了一个证书，为了兼容采用双 root ，
然后微信支付官方 c++库比较老，估计不认双 root ，所以会出现问题，后来我提了 bug---大概 2 年前左右。。。
这两年没啥问题。。。

---------------------------------------------------

我也遇到这个问题了，然后发现申请历史里面有个去年的申请扔那没管，用去年的那个申请提交了一下，还是 1 年的期限。

---------------------------------------------------

@encro 21 年 9 月份，我的邮箱服务器国庆期间自动更新证书，炸了，记忆犹新。

---------------------------------------------------

换成 caddy 了，省心省力

---------------------------------------------------

@veike #2 不会吧，我一直用没问题的

---------------------------------------------------

这种中国人企业的“证书”你们也敢用阿？不怕总参三部随便拿到吗？

---------------------------------------------------

@FightPig 我也是

---------------------------------------------------

@salmon5 TrustAsia 也要修改了，到时候都会一起变的
https://www.trustasia.com/view-free-ssl-one-year-adjustment-announcement/

---------------------------------------------------

@Foxkeh 最早的 acme 生成证书只有 cert 文件前面两部分，而完整证书需要三部分。那时候浏览器访问是没问题的，但是微信小程序认为证书不全不认 https ，需要手动生成补全才能用。后来不知道什么时候 acme 改了可以选择生成完整证书，再后来默认证书就是完整三部分。大概是这个原因

---------------------------------------------------

acme 不要太方便

---------------------------------------------------

https://www.cloudflare.com/ 、acme 、freessl 不香吗？非要去搞阿里云的。

---------------------------------------------------

acme 或者 cloud flare 申请 GTS

---------------------------------------------------

@veike 腾讯云也有免费证书

---------------------------------------------------

七牛云的 TustAsian 还是 1 年

---------------------------------------------------

let's 的挺好用呀，搞个 crontab ，certbot 一条简短的命令就搞定了证书更新。

---------------------------------------------------

3 个月, 那我还不如用 let's encrypt 了. 还能自动续租.

---------------------------------------------------

@veike 


瞎说，我用 let's 快 10 年了，小程序公众号啥都没问题。

---------------------------------------------------

@veike 

let's 有段时间出问题是因为以前的 root 证书过期了。。。后来换了一个证书，为了兼容采用双 root ，
然后微信支付官方 c++库比较老，估计不认双 root ，所以会出现问题，后来我提了 bug---大概 2 年前左右。。。
这两年没啥问题。。。

---------------------------------------------------

我也遇到这个问题了，然后发现申请历史里面有个去年的申请扔那没管，用去年的那个申请提交了一下，还是 1 年的期限。

---------------------------------------------------

@encro 21 年 9 月份，我的邮箱服务器国庆期间自动更新证书，炸了，记忆犹新。

---------------------------------------------------

换成 caddy 了，省心省力

---------------------------------------------------

@veike #2 不会吧，我一直用没问题的

---------------------------------------------------

这种中国人企业的“证书”你们也敢用阿？不怕总参三部随便拿到吗？

---------------------------------------------------

@FightPig 我也是

---------------------------------------------------

@salmon5 TrustAsia 也要修改了，到时候都会一起变的
https://www.trustasia.com/view-free-ssl-one-year-adjustment-announcement/

---------------------------------------------------

@Foxkeh 最早的 acme 生成证书只有 cert 文件前面两部分，而完整证书需要三部分。那时候浏览器访问是没问题的，但是微信小程序认为证书不全不认 https ，需要手动生成补全才能用。后来不知道什么时候 acme 改了可以选择生成完整证书，再后来默认证书就是完整三部分。大概是这个原因

---------------------------------------------------

acme 不要太方便

---------------------------------------------------

https://www.cloudflare.com/ 、acme 、freessl 不香吗？非要去搞阿里云的。

---------------------------------------------------

acme 或者 cloud flare 申请 GTS

---------------------------------------------------

@veike 腾讯云也有免费证书

---------------------------------------------------

七牛云的 TustAsian 还是 1 年

---------------------------------------------------

let's 的挺好用呀，搞个 crontab ，certbot 一条简短的命令就搞定了证书更新。

---------------------------------------------------

3 个月, 那我还不如用 let's encrypt 了. 还能自动续租.

---------------------------------------------------

@veike 


瞎说，我用 let's 快 10 年了，小程序公众号啥都没问题。

---------------------------------------------------

@veike 

let's 有段时间出问题是因为以前的 root 证书过期了。。。后来换了一个证书，为了兼容采用双 root ，
然后微信支付官方 c++库比较老，估计不认双 root ，所以会出现问题，后来我提了 bug---大概 2 年前左右。。。
这两年没啥问题。。。

---------------------------------------------------

我也遇到这个问题了，然后发现申请历史里面有个去年的申请扔那没管，用去年的那个申请提交了一下，还是 1 年的期限。

---------------------------------------------------

@encro 21 年 9 月份，我的邮箱服务器国庆期间自动更新证书，炸了，记忆犹新。

---------------------------------------------------

换成 caddy 了，省心省力

---------------------------------------------------

@veike #2 不会吧，我一直用没问题的

---------------------------------------------------

这种中国人企业的“证书”你们也敢用阿？不怕总参三部随便拿到吗？

---------------------------------------------------

@FightPig 我也是

---------------------------------------------------

@salmon5 TrustAsia 也要修改了，到时候都会一起变的
https://www.trustasia.com/view-free-ssl-one-year-adjustment-announcement/

---------------------------------------------------

@Foxkeh 最早的 acme 生成证书只有 cert 文件前面两部分，而完整证书需要三部分。那时候浏览器访问是没问题的，但是微信小程序认为证书不全不认 https ，需要手动生成补全才能用。后来不知道什么时候 acme 改了可以选择生成完整证书，再后来默认证书就是完整三部分。大概是这个原因

---------------------------------------------------

acme 不要太方便

---------------------------------------------------

https://www.cloudflare.com/ 、acme 、freessl 不香吗？非要去搞阿里云的。

---------------------------------------------------

acme 或者 cloud flare 申请 GTS

---------------------------------------------------

@veike 腾讯云也有免费证书

---------------------------------------------------

七牛云的 TustAsian 还是 1 年

---------------------------------------------------

let's 的挺好用呀，搞个 crontab ，certbot 一条简短的命令就搞定了证书更新。

---------------------------------------------------

3 个月, 那我还不如用 let's encrypt 了. 还能自动续租.

---------------------------------------------------

@veike 


瞎说，我用 let's 快 10 年了，小程序公众号啥都没问题。

---------------------------------------------------

@veike 

let's 有段时间出问题是因为以前的 root 证书过期了。。。后来换了一个证书，为了兼容采用双 root ，
然后微信支付官方 c++库比较老，估计不认双 root ，所以会出现问题，后来我提了 bug---大概 2 年前左右。。。
这两年没啥问题。。。

---------------------------------------------------

我也遇到这个问题了，然后发现申请历史里面有个去年的申请扔那没管，用去年的那个申请提交了一下，还是 1 年的期限。

---------------------------------------------------

@encro 21 年 9 月份，我的邮箱服务器国庆期间自动更新证书，炸了，记忆犹新。

---------------------------------------------------

换成 caddy 了，省心省力

---------------------------------------------------

@veike #2 不会吧，我一直用没问题的

---------------------------------------------------

这种中国人企业的“证书”你们也敢用阿？不怕总参三部随便拿到吗？

---------------------------------------------------

@FightPig 我也是

---------------------------------------------------

@salmon5 TrustAsia 也要修改了，到时候都会一起变的
https://www.trustasia.com/view-free-ssl-one-year-adjustment-announcement/

---------------------------------------------------

@Foxkeh 最早的 acme 生成证书只有 cert 文件前面两部分，而完整证书需要三部分。那时候浏览器访问是没问题的，但是微信小程序认为证书不全不认 https ，需要手动生成补全才能用。后来不知道什么时候 acme 改了可以选择生成完整证书，再后来默认证书就是完整三部分。大概是这个原因

---------------------------------------------------

acme 不要太方便

---------------------------------------------------

https://www.cloudflare.com/ 、acme 、freessl 不香吗？非要去搞阿里云的。

---------------------------------------------------

acme 或者 cloud flare 申请 GTS

---------------------------------------------------

@veike 腾讯云也有免费证书

---------------------------------------------------

七牛云的 TustAsian 还是 1 年

---------------------------------------------------

let's 的挺好用呀，搞个 crontab ，certbot 一条简短的命令就搞定了证书更新。

---------------------------------------------------

3 个月, 那我还不如用 let's encrypt 了. 还能自动续租.

