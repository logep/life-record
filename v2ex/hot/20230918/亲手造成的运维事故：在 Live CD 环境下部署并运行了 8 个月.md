### 亲手造成的运维事故：在 Live CD 环境下部署并运行了 8 个月

前情提要：今年春节时去部署了一套内部系统，访问量不大，加上临近春节协调资源难，就先单机部署了，
对方提供的是 H3C 的物理机，准备安装 Ubuntu 系统，对运维要求带桌面安装，
中途被电话打断，回到机器旁边看到已经在 Ubuntu 桌面了以为对方运维帮装好了，
于是直接部署好了我们的系统，测试没问题就离开了，后面也一直相安无事，没出过什么问题。

直到昨天晚上组里同事去给他们更新部署，由于各种巧合提示磁盘空间不足，于是各种操作后给重启了机器，
发现.....进 Live CD 桌面，目录是空的，重启弹出光盘，提示找不到启动磁盘，
通宵一夜后就在刚刚给我打来了电话，我：？？？？
各种记忆恢复术后想起来，当时 Ubuntu 压根就没装进硬盘啊？

由于是单机部署，暂时没想到能恢复数据的方法...

---------------------------------------------------

找对方运维背锅吧

---------------------------------------------------

没有备份的数据都可以认为是不重要的，这锅对方运维至少有一半是跑不了的。

---------------------------------------------------

正常人不会重启就备份数据吧？这个问题在于楼主，话说 livecd 应该一眼就能看出来啊，桌面有个安装图标

---------------------------------------------------

牛逼

---------------------------------------------------

我还是认为对方运维（甚至更高的领导）责任重大，重要的数据至少每 24 小时备份一次，看情况保留 3 至 10 个副本是“安全”级别的要求。

---------------------------------------------------

两个大聪明。

---------------------------------------------------

数据肯定恢复不了啊，都是跑在缓存和内容里面的，掉电清空了，能找回就见鬼了

---------------------------------------------------

翻译翻译：win PE 里玩了 8 个月游戏。6666

---------------------------------------------------

還以為服務器都是沒有桌面的。

---------------------------------------------------

linux 真稳！

---------------------------------------------------

本日最佳笑话

---------------------------------------------------

两个运维都不做检查吗？

---------------------------------------------------

没事，你就当硬盘坏了。

---------------------------------------------------

@lloovve 正常的运维会每天（最差最差也是每月）自动化备份数据，优秀的运维会找方案做实时备份数据并制定 3-2-1 备份计划，极其优秀的运维还会每隔几个月做一次灾备演练。

---------------------------------------------------

666

话说提示磁盘空间不足就没 df -h 看下磁盘空间啊

---------------------------------------------------

两个大聪明，话说提示磁盘不足为什么需要重启？

---------------------------------------------------

8 個月不備份說明也不是什麼重要的東西

---------------------------------------------------

由于各种巧合提示磁盘空间不足，于是各种操作后给重启了机器
真的会运维吗？ 随便一个 df 之类的都能发现吧。

---------------------------------------------------

@kingfalse  单机本地存档游戏

---------------------------------------------------

666666

---------------------------------------------------

数据应该不重要吧

---------------------------------------------------

搬小板凳看戏，太乐了。

---------------------------------------------------

有卧龙的地方，必有凤雏

---------------------------------------------------

卧龙凤雏, 一言不合重启机器

---------------------------------------------------

经典的：重启逝世

---------------------------------------------------

锅 5:5 开

---------------------------------------------------

瞎猫碰到死耗子

---------------------------------------------------

卧龙三米之内必有凤雏

---------------------------------------------------

牛逼

---------------------------------------------------

有望成为近期最佳

不过桌面上那么大一个 Install Ubuntu 一直没人看到么...

---------------------------------------------------

卧龙凤雏.jpg

---------------------------------------------------

重启不是正常操作么  嘿嘿嘿

---------------------------------------------------

1 、桌面上有个 install Ubuntu 的图标。
2 、/ monunt 点只有 2G ，文件系统名叫/cow,分区非常多，比正常的多太多了
3 、没有编译环境、什么环境都没有。运营的环境至少安装个 gcc 吧。
这些都是异常情况。

---------------------------------------------------

牛逼

---------------------------------------------------

1. 对方运维主要责任。机器安装系统给个 live cd 环境？
2. 己方没有做好异地备份，次责。
3. 谨慎重启操作系统，系统运行久了，日常部署多了，没做部署日志的话。一旦重启容易遗忘一些重要配置。

---------------------------------------------------

这竟然还能跑 8 个月？

---------------------------------------------------

live CD：从没想过有一点我还能上生产跑业务，满足了

---------------------------------------------------

好笑归好笑，不过我查了一下，有些 live cd 的确可以把数据持久化的

---------------------------------------------------

高，实在是高！

---------------------------------------------------

live CD 跑起来了 https://i.imgur.com/xr1UOz1.png

---------------------------------------------------

反正主锅不是你

---------------------------------------------------

8 个月，这要寄啊

---------------------------------------------------

过于逆天了 发给运维同事了

---------------------------------------------------

@wonderfulcxm 看起来已经重启啦，，

---------------------------------------------------

Linux 真稳😆

---------------------------------------------------

这个经历真够离谱啊……

---------------------------------------------------

看你们的甩锅技术了。。。

---------------------------------------------------

成功缓解了周一上班的不适

---------------------------------------------------

卧龙凤雏

---------------------------------------------------

Live CD 运行 8 个月不挂也是真的牛批！

---------------------------------------------------

live CD 遗言：这辈子值了。

---------------------------------------------------

@lrh3321 #2 @roundgis #17 @yfixx #21 某种意义上来说...数据确实不算重要，年后就忘了这件事了，甚至早上还想了几分钟什么时候有这个系统了

@cmdOptionKana #5 @msg7086 #14 正常我们是做了备份策略的，只不过对方在内网用，没公网，临近春节找不到人开个 minio/ftp/nfs 之类的服务给我们做备份用，年后这事也忘记了，一直没出过问题

@davidyin #9 是对方运维强烈要求带桌面，正常我们也就 cli 部署了

@Routeros #10 是啊，真稳，Live CD 跑那么久都没出问题

@wuzhewuyou #15 @des #16 @devopsdogdog #18 组里另一个同事昨天晚上去搞的，他发现磁盘没分区没挂载，也没想到居然是在 Live CD ，手动分区挂载准备迁移数据发现挂不上，就直接给重启了

@lloovve #3 @k9982874 #12 @crayygy #30 @wangxiaoaer #33 @darksword21 #36 @goodryb #37 当时临近春节，对方各种催他们想早点下班，第一次在物理机装带桌面的部署，我也没在意桌面的 Install Ubuntu 图标，关键是呢，一切都太顺利了，内网连接正常，usb 共享了 4G 网络进去，也正常上网，apt 更新，装各种依赖，dotnet restore ，npm install ，docker run ，全程一次性完成没出问题，万万没想到这是在 Live CD ，本想春节后加个副本和协调个备份服务的，这事给忘记了

---------------------------------------------------

@oblivion #51 apt 更新完竟然没重启这是我没想到的。
一般至少要重启一次，测试一下 docker 在重启后有没有自动起来吧。

---------------------------------------------------

这能运行 8 个月，也是 6

---------------------------------------------------

今天的好心情来源于此

---------------------------------------------------

忍不住大笑了起来

---------------------------------------------------

楼主能否透露一下后续情况吗？是否因此受到处罚啥的？

---------------------------------------------------

忍不住笑了。。。
可以列入奇葩故障排行榜

---------------------------------------------------

必然还是你的锅，Live 系统 df 一把一下就能看出来。

---------------------------------------------------

真的牛逼，整笑了

---------------------------------------------------

客户想着咱尾款付了呀，你给我弄个不定时炸弹

---------------------------------------------------

装完系统，我一般会重启两次服务器～

---------------------------------------------------

“组里另一个同事昨天晚上去搞的，他发现磁盘没分区没挂载，也没想到居然是在 Live CD ，手动分区挂载准备迁移数据发现挂不上，就直接给重启了”

可以抓住这点：运行没问题，重启有责任 哈哈

---------------------------------------------------

自爆卡车

---------------------------------------------------

你这个贴子，和首页那个 2000 块要破解微软邮箱验证码方案的，可以承包我这一周的笑点。。。

---------------------------------------------------

「哪里能随便重启生产环境的啊！你看被你搞崩了吧！」
甩锅完毕

---------------------------------------------------

就是赛博华佗来了也是于事无补，除了 卧槽 之外想不出别的词了

---------------------------------------------------

ubuntu 的 live cd 我记得桌面有个 install 的图标的👀

---------------------------------------------------

@oblivion #52 真的佩服你，你是咋这么细心一个一个的回复这么多人的 ？上上下下的找好麻烦啊。

---------------------------------------------------

@lloovve 至少对半开，不可能全怪楼主

——如果贵司根本不存在"数据备份"的概念，主打的就是一个“不死万万年，人死鸟朝天”，那也是相当硬核的。

---------------------------------------------------

笑死，绝了

---------------------------------------------------

一般人还真想不到部署的应用能跑在 live cd 下

---------------------------------------------------

太强了，live cd 环境竟然这么稳，能跑 8 个月

---------------------------------------------------

对方运维背大锅，让装系统装哪去了？

---------------------------------------------------

我不信

---------------------------------------------------

今日最佳帖。

---------------------------------------------------

我还是感觉这个 Live CD 太强了，整整八个月。。

---------------------------------------------------

过于离谱。。。。我做梦都想不到这样的场景

---------------------------------------------------

这个 docker run 也挺魔性, 竟然不用挂载磁盘, 说明确实没太多数据需要永久保存的

---------------------------------------------------

同情，看看后面怎么处理吧

---------------------------------------------------

强，这没出事的话，磁盘够的话，是不是还能运行个一年🐶

---------------------------------------------------

。。。这个也太。。。。

---------------------------------------------------

@LokiSharp #1 @cmdOptionKana #5 @msg7086 #14 @yfixx #21 @Felldeadbird #35 @zhangyq008 #47 @ysc3839 #57 @defunct9 #59 @rocksolid #61 @mark2025 #62 @NessajCN #66 @kenvix #74

更新最新情况：

关于甩锅情况：早上接到电话就已经先按 @NessajCN #66 锅先甩给同事了（开个玩笑），已经重新装好系统部署好在用了，
关于背锅情况：对方运维也忘记具体情况了，暂时没人背锅（对方计划甩锅 SSD 故障），暂时也不需要背锅，
关于系统情况：这一套是几家运营商都在用的非关键系统，本次出问题的是其中一家运营商的某地某公司，主要是用于管理外包工单和调用接口发短信通知，通讯录，改派，通过其他系统接口关联资源之类的功能，历史数据用途不大，当天用完数据就没什么用了，
关于数据情况：本质上是 Excel 导入导出管理系统，网管电脑也没删下载目录，要恢复数据的话通宵几天还是能恢复的，
关于尾款情况：对方一次性全付，没尾款
关于想不通的地方：为什么啊为什么啊，为什么能运行 8 个月都没出问题，就普通办公区临时机柜，没有 UPS ，没多路市电，没挂硬盘，还能稳定运行这么久

---------------------------------------------------

调机上正线（

---------------------------------------------------

@ucando #79 是有数据库和 redis 的，想不通磁盘满了为什么还能正常工作
@docx #80 沟通好了，非关键系统没什么需要处理的，对方运维讲实在不行甩锅 SSD 故障
@wondering #81 可能磁盘早满了吧，昨天是需要加个功能更新部署，不去动说不定明年都没发现

---------------------------------------------------

什么是牛逼，这就是牛逼。

话说运维强烈要求带桌面是什么操作。。

---------------------------------------------------

部署完项目居然没重启一次试试服务能不能自启🤣
  果然是能跑就别动，动一下都可能会以意想不到的方式垮掉

---------------------------------------------------

@oblivion LiveCD 应该是 overlayfs 吧，叠加层估计在内存里，所以内存足够大的话是很稳定的

---------------------------------------------------

@oblivion 如果你想问为什么能长期不重启，我家里的路由器也可以呀

---------------------------------------------------

@LokiSharp 甩锅才是最重要的

---------------------------------------------------

过于传奇

---------------------------------------------------

一群神人……

---------------------------------------------------

@ayase252 何止调机上正线，简直 tm 是调机跑图定长交路

---------------------------------------------------

「运维要求带桌面安装」，就这一点，运维就得背锅。

---------------------------------------------------

就这么跑了八个月简直是人间奇迹

---------------------------------------------------

Linux 真稳定啊

---------------------------------------------------

@ysc3839 #88 而且内存带 ecc 小问题能自己纠错。去掉了硬盘故障率更低了。系统也确实稳定。业务量又不是很大，造就了传奇。唯一的缺点就是数据没了，反正不重要😂

---------------------------------------------------

今日最佳！！！

---------------------------------------------------

@oblivion 這是 ubuntu 的活廣告 不錯

---------------------------------------------------

啊，你自己愿意背锅，，，怎知道 cd 是什么是否放入的呢。

---------------------------------------------------

@davidyin #9 
国产化的服务器系统甚至不能没有桌面
资源紧张想不要桌面都不行

---------------------------------------------------

重啟治百病   藥到命除

---------------------------------------------------

卧龙凤雏，为啥不 df 看下空间占用

---------------------------------------------------

好奇，live cd 环境下，你的应用程序是怎么部署成功。。。

---------------------------------------------------

系统装完直接部署？

难道不是应该 update&upgrade 一下再重启后部署么？

---------------------------------------------------

@Iamsonny live cd 环境，其实就是把/挂到内存里，只要内存不满的话该干嘛干嘛。。

---------------------------------------------------

@raptor 新版 ubuntu 在更新完后会提示重启受影响的服务来达到不用重启就能完成更新.

---------------------------------------------------

这让我想起了自己服务器一些临时服务懒得写服务脚本，开个 tmux 终端命令行直接跑然后 detach ，就这样服务器运行 1 年多没重启过积累了好多临时服务，某天意外断电重启后已经忘了要跑哪些服务了😂

---------------------------------------------------

这也太 6 了吧 6 到停不下来

---------------------------------------------------

@yyzh 我信不过这种，都是重启一次系统。

---------------------------------------------------

谢谢你，让我今天有了好心情 :)

---------------------------------------------------

6 啊

---------------------------------------------------

应了那句话，能用了就别动。

---------------------------------------------------

ubuntu 20.04 和 22.04, 有个自动更新服务. 前几天自动更新.把我 mysql 重启了.  我承认我菜.

---------------------------------------------------

nba... 带桌面安装已经很奇葩了，难道安装时 apt update 不会看到有 livecd 的源，用 terminal 部署不是会注意到主机名和 username 有 livecd 的痕迹么。。。
更何况看起来你们是传统部署（非 K8s/容器），一般不是应该看看系统重启后，服务能否自行恢复启动么？（不过确实也难说，大学时某外包公司给我校部署的某系统就是开个 terminal ./start.sh 跑的，nohup 都没有，更别说 service 。“稳定”运行半年后，机房双路供电异常重启，服务就挂了）

---------------------------------------------------

怎么做到的，震惊。。

---------------------------------------------------

噗。。。对不起。。。我忍不住笑出声了（手动狗头.jpg

---------------------------------------------------

为啥不用老毛桃 windows pe 呢

---------------------------------------------------

不行，我今天的功德没了，但还是请允许我笑一会儿

---------------------------------------------------

看对面也不怎么会 linux 运营吧？硬盘不足折腾不行就用万能重启法？把锅甩给对面，说 linux 系统不能随便

---------------------------------------------------

@msg7086 那么重启前会不会备份？

---------------------------------------------------

属实牛逼

---------------------------------------------------

你用 PE 还能挂载硬盘

---------------------------------------------------

我的习惯：业务系统部署完之后一定要把涉及到的服务器都重启一遍还是否可以无人工介入的情况下正常服务。

---------------------------------------------------

linux to go

---------------------------------------------------

@adoal 这真是个好习惯

---------------------------------------------------

稳！

---------------------------------------------------

连夜提桶跑路

---------------------------------------------------

#124 然后发现机器上原有的服务炸了，寄

---------------------------------------------------

忽然想到是不是应该提供一个带 docker 引擎的 live cd ，然后启动后，运行容器，数据持久化到硬盘。硬盘就干干净净，只要数据。😄😄😄

---------------------------------------------------

这锅得甩给对方运维，这几个月了居然没发现

---------------------------------------------------

这八个月没巡检过吗😂

---------------------------------------------------

install ubuntu

---------------------------------------------------

我觉得你们的人也有责任，即使我自己家里的 N5105 小主机，我要更新前，也是用 tar 把目录备份，copy 到 U 盘里。当然也需要有良好的习惯，比如我所有的配置都放在 /srv ，只备份它就行。 你们的人，居然不做备份，直接重启，也是要负责任的。

---------------------------------------------------

自爆

---------------------------------------------------

@paranoiagu 讲道理你说的这不是 unraid 么，系统就在 U 盘里，磁盘阵列每块硬盘单独拿出来在别的电脑上都能正常读写

---------------------------------------------------

安装完的时候不升级组件、内核那些再重启的么？

---------------------------------------------------

作为 incident followup, 可以去 ubuntu 提 issue, 建议 live cd 环境下，每隔 24 小时弹窗警告。

---------------------------------------------------

慕名而来

---------------------------------------------------

生产至少两个副本吧，两个 live cd ，重启一个还有另一个

---------------------------------------------------

1.难，就先 XXX ，这才是最大的问题，本质是贪了。难就不应该急着去处理，先把难点解决了再说。

2.Live CD 好好规划，当成生产其实问题不大。但问题是，你们没好好规划。

---------------------------------------------------

刚经历过一场事故，恢复数据，那叫一个痛啊

---------------------------------------------------

你们就没有人尝试过取下光盘吗？还是说光驱就一直挂在服务器上没管，也真行。

LiveCD 拔下光驱没多久就会报错了，因为它不像 WinPE 那样一次性加载到内存，而只是缓存部分。

LiveCD 部署环境我也干过，是测试环境，机器紧张硬盘又被借走了。内存 500G+，LiveCD 上装个 docker 直接无盘跑测试了。就是因为这个我知道 LiveCD 卸载光盘就会报错的。

---------------------------------------------------

笑死了

---------------------------------------------------

@lloovve 重启前应该至少备份了 8 次了（茶）

---------------------------------------------------

服务器带 UI 就不太合理。。

---------------------------------------------------

@kingfalse 现在看出来 Windows PE 的 72 小时强制重启的作用了 ;)

---------------------------------------------------

看笑了

---------------------------------------------------

1.难，就先 XXX ，这才是最大的问题，本质是贪了。难就不应该急着去处理，先把难点解决了再说。

2.Live CD 好好规划，当成生产其实问题不大。但问题是，你们没好好规划。

---------------------------------------------------

刚经历过一场事故，恢复数据，那叫一个痛啊

---------------------------------------------------

你们就没有人尝试过取下光盘吗？还是说光驱就一直挂在服务器上没管，也真行。

LiveCD 拔下光驱没多久就会报错了，因为它不像 WinPE 那样一次性加载到内存，而只是缓存部分。

LiveCD 部署环境我也干过，是测试环境，机器紧张硬盘又被借走了。内存 500G+，LiveCD 上装个 docker 直接无盘跑测试了。就是因为这个我知道 LiveCD 卸载光盘就会报错的。

---------------------------------------------------

笑死了

---------------------------------------------------

@lloovve 重启前应该至少备份了 8 次了（茶）

---------------------------------------------------

服务器带 UI 就不太合理。。

---------------------------------------------------

@kingfalse 现在看出来 Windows PE 的 72 小时强制重启的作用了 ;)

---------------------------------------------------

看笑了

---------------------------------------------------

1.难，就先 XXX ，这才是最大的问题，本质是贪了。难就不应该急着去处理，先把难点解决了再说。

2.Live CD 好好规划，当成生产其实问题不大。但问题是，你们没好好规划。

---------------------------------------------------

刚经历过一场事故，恢复数据，那叫一个痛啊

---------------------------------------------------

你们就没有人尝试过取下光盘吗？还是说光驱就一直挂在服务器上没管，也真行。

LiveCD 拔下光驱没多久就会报错了，因为它不像 WinPE 那样一次性加载到内存，而只是缓存部分。

LiveCD 部署环境我也干过，是测试环境，机器紧张硬盘又被借走了。内存 500G+，LiveCD 上装个 docker 直接无盘跑测试了。就是因为这个我知道 LiveCD 卸载光盘就会报错的。

---------------------------------------------------

笑死了

---------------------------------------------------

@lloovve 重启前应该至少备份了 8 次了（茶）

---------------------------------------------------

服务器带 UI 就不太合理。。

---------------------------------------------------

@kingfalse 现在看出来 Windows PE 的 72 小时强制重启的作用了 ;)

---------------------------------------------------

看笑了

