### 问一个前后端对接问题

我们一套系统 PC 、小程序、ios 、android 都对接统一接口，但是 ios 、android 一直喜欢抱怨接口结构这不行，那嫌麻烦，不建议用。。。找不到到底是谁的问题。
举个例子：
A 接口返回结构
```
{
	"SKU_铅笔": {
		"q1": 123,
		"sku": "SKU_铅笔"
	},
	"SKU_书本": {
		"q1": 456,
		"sku": "SKU_书本"
	}
}
```
这种是把 sku 分类返给前端

1 、PC 、小程序的前端认为这样很方便，列表的地方直接循环不用管键名。具体值也可以直接取对应 sku 内容，不用去循环，比如 obj['SKU_铅笔']。

2 、ios 认为这样不规范，哪有人键名是字符串的，还有中文 ,android 也认为键名是字符串他不好循环，嫌各种麻烦。

遇到这种问题要如何解决？

---------------------------------------------------

转成数组其实更合理一些，现在的这个接口有着以下明显问题：
1. 类型或者含义不算好描述
2. 不同 SKU 之间是否有顺序，顺序是怎么表达的

PC 、小程序觉得好用，大概率是没比较好的用有 TypeScript 能类型系统，被弱类型的 JavaScript 给惯的

---------------------------------------------------

不建议你这么写, 应该改成数组

---------------------------------------------------

如果让我这个格式发给前端，我都过不去自己心里的那一关。

---------------------------------------------------

就你举得例子，结构确实不好。
强类型的语言要定义结构做 json 序列化，这就很难定义。

---------------------------------------------------

没了解过客户端，原来 key 不推荐用字符串么...之前呆过的公司如果给客户端的接口 web 端复用的话，后端另写 service 接口或者 nodejs 中转

---------------------------------------------------

[
    {
        "sku": "SKU_铅笔",
        "q1": 123
    },
    {
        "sku": "SKU_书本",
        "q1": 456
    }
]
 这样更好一些

---------------------------------------------------

建议换成数组

---------------------------------------------------

@NerbraskaGuy #5

主要是楼主这个 key 跟他 value 里的内容有极大重叠，设计上本来就应该直接用数组了事。

pc/小程序的前端纯粹就是想偷懒，看楼主这种数据应该也不是特别多，前端对数据做下处理也不会对性能和体验造成什么比较明显影响。

---------------------------------------------------

@george2077 好坏怎么定义？比如改成你这种格式 ，js 前端取"SKU_铅笔"的内容他就要去循环判断 sku=="SKU_铅笔"，增加他的工作量。

---------------------------------------------------

@flyqie 确实这么返回对 web 前端很省事，估计也不想跟后端 battle 就这么处理完事了

---------------------------------------------------

@zhangtest 后端表示也不喜欢这种。  前端取"SKU_铅笔"的内容 filter 不就可以了吗

---------------------------------------------------

@flyqie 这种需求结构不多，“pc/小程序偷懒”不认同，因为他们从来没有诉求，你给什么都能处理，只是 sku 做 key 他们取数据简单些。要说偷懒 ios 、android 才更像，他们也能处理但是经常抱怨。

---------------------------------------------------

用数组

---------------------------------------------------

你这样本来就不合理，难怪别人吐槽, #6 正解, js 、小程序自己接收到数据自己处理就行，而且前端这点执行消耗不了多少资源，你这样返回每个 key 都不固定 别人肯定也不好解析

---------------------------------------------------

@zhangtest #9 恰好我们公司也有 web ios 和 Android   这种问题我们也讨论过几次了，实际上最简单你理解就行了，web 他们用的 js ，不是 ts ，不是强类型，这种直接当成 ObjectKeys 去遍历解析就行了，我们公司 app 用的 flatter ，然后他们好像是不允许用反射的，也就是说没有类似 JsonPrase 之类的方法，他们习惯是拿后端给的返回值，json 生成 class ，把代码直接 copy 到项目里去用，然后你这种基本属于是一个 Map<string,Object>的类型，对于他们来说就不能使用 class ，使用的时候也要去当 Map 去用，如果涉及到取值的地方，只能 map["string"]这么去取 value ，换我我也不乐意，你这基本限制了前端只能遍历去取值了

---------------------------------------------------

因为 PC/小程序是 js 写的逻辑，没有强类型定义，你返回的对象 key 怎么变都能收，但是 ios 与 android 的逻辑是强类型语言写的，必须要先定义一个对象来接收，你这种返回，对象的 key 一直在变，如何预先定义对象，当然可以用 object 来接收，然后用反射来搞，但是这样会损耗前端性能，而且代码也麻烦多了

---------------------------------------------------

不合理 太野鸡了这样

---------------------------------------------------

这种数据给后端可以,给前端就是自找麻烦

---------------------------------------------------

@putyy 老哥先搞清楚，接口是一套，要照顾所有人，后端怎么给都可以，现在的矛盾点是 ios 、android 和 pc/小程序 对于结构认知不一样。

---------------------------------------------------

@zhangtest “pc/小程序偷懒”不认同，因为他们从来没有诉求，你给什么都能处理
这也可以换种说法更像是培训出来的前端完全没代码质量想法吧..

---------------------------------------------------

前后端都做，你就知道这种数据结构的问题了。我有次也设计了个这种数据结构（ key 是变化的），前端（自己写前端）用得那叫一个难受

---------------------------------------------------

@zhangtest “具体值也可以直接取对应 sku 内容，不用去循环，比如 obj['SKU_铅笔']”，这个 obj['SKU_铅笔']里的“SKU_铅笔”信息是从哪儿得到的呢

---------------------------------------------------

@abelmakihara 不用讨论这个没有意义，公司以结果为导向，做的项目运营稳定，客户满意就行，他们不会去看你代码。

---------------------------------------------------

如果不是 PC/小程序前端偷懒，那就是你的问题，key 用随机的字符串就是不合理，这种情况就得用数组

---------------------------------------------------

@george2077 我也觉得应该用这种形式。 对象的 key 不应该是动态的，动态的 key 不管前端后端处理起来都不方便。Map<String,SkuDto>后端觉得这种好像没问题，但是如果你想，你要是把 key 换成 id 的话，前端是不是跟吃 shi 一样难受

---------------------------------------------------

我也是前端，这种数据格式只会让我觉得后端返回的有问题。

 而且我看了你在这个帖子的回复 哥们，你太能犟了，你不是来寻求建议的 ，你是来找认同的，你不想改，又 battle 不过移动端，想拉拢 web 端。

---------------------------------------------------

讲那么多 你是来找认同的吧，自己去写写客户端就知道为什么了。不是不处理，是你这方式就给别人添乱增加无效工作。

---------------------------------------------------

@yinaqu 举个例子，商家有很多商品，商品属性有相同点和不同点，不同点有自己的过期时间等，相同点他们属于同 SPU 等 ，这些是以最小 SKU 记录在数据库里面的，后期突然产品来个需求，说要显示 SPU 对应数量，最大最小价格。。。那么后端就把所有记录查出来按照 SPU 分类整理一些数据给前端。

---------------------------------------------------

前端、小程序是 2 。
这接口明显是只返回数组就可以了。
自己再根据自己需要生成 map 或其它什么的。

---------------------------------------------------

作为一个后端，我非常不喜欢将数据内容作为 key ， 除非接口是某些 map 结构确实是需要如此，正常而言我的选择是以下两种设计。

要么 返回树：
[{ "id": 11,  "name": "sku_铅笔", "children": [ "q1": 123, "sku": "SKU_铅笔"]}, {id:12, "name": "sku_书本", children : ...}]

要么分俩接口， 一个 sku 列表，一个具体商品目录，商品属性要有归属的分类 id ，
[{ "id": 11,  "name": "sku_铅笔"}, {id:12, "name": "sku_书本"}]

[{"qi":123, "sku": "sku_铅笔", "categoryId": 11}, { "q1": 456, "sku": "SKU_书本", "categoryId": 12}]


就一个观点，我不接受可变的数据属性作为其他数据的依赖，id ，1 永远是 1 只能增删，不能修改， 而 sku_铅笔，随时可以被人修改，比如新增一个分类，sku_自动铅，并将原来的 sku_铅笔改为 sku_传统铅笔。

---------------------------------------------------

请问强类型咋定义 model 呢……

---------------------------------------------------

@muunala10221 脑补的很丰富，自愧不如。

---------------------------------------------------

肯定吐槽，你这种数据结构肯定用对象数组合适，后端非要犟着不改那也不是不能用。反正之前遇到这样的后端，提了不改，也懒得扯皮。

---------------------------------------------------

@zpf124 这种需求很少，不会刻意去做的，你看下 28 楼的原始需求就明白怎么回事。

---------------------------------------------------

一句话说完，后面如果要改，后端修改成本高还是前端？ 这么简单的事情，后端都需要狡辩

---------------------------------------------------

@Ayanokouji 看下 28 楼原始需求说明。

---------------------------------------------------

@NerbraskaGuy 我们人员比较多，这种问题会一起开会讨论，没有谁 battle 谁，都是自己说出自己的观点，省事是 web 自己说的。

---------------------------------------------------

@Desiree 这不是在讨论吗？每个人都喜欢站在自己的角度看问题，最终还是要综合评估选择方案，如果讨论都那么敌视，火药味那么大，那一起上班得多累。

---------------------------------------------------

后端从业门槛这么低了么？

---------------------------------------------------

数组不数组是一个问题，首先是这个 key 是不是唯一的主键。如果是主键，那用作 key 倒也没问题。
至于写 JS 代码用不用循环，这个不是你要考虑的问题。
obj[sku]和 obj.find(o => o.sku === sku)并不是很显著的差异。
甚至如果前端有大量的查询，可以在前端生成一个 hashmap 来提速：
hashmap = data.reduce((acc, o) => ({...acc, [o.sku]:o}), {})

---------------------------------------------------

@zhangtest 15 、16 楼都说的这么清楚了。你还搁这装睡呢？ 说到这地步了，还扯什么呢？

---------------------------------------------------

@byc4i 你吃火药了吗？ 15 、16 说了这帖子就要关闭？让更多的人都说下话要你命了？

---------------------------------------------------

说实话,你这返回数据结构有问题,本来是数组格式的数据,你偏偏要按 key 返回
我后端,前端和 Android 都做过,Android 开发中,json 返回数组是网络情况框架 json 自动转换成 java 对象,这种返回 key 的 json 不能直接转成 java 对象,要恶心的手动解析

---------------------------------------------------

@msg7086 这类需求都是要代码整理数据，key 是主键，看 28 楼原始需求说明。

---------------------------------------------------

iOS & Android 是对的。

---------------------------------------------------

商品是一堆(数组).还是一个(对象).

-------
在我看来,是一堆有相同属性,不同值的对象.所以应该用数组.
-------

前端是有 es6 的啊, 可以用 find 直接找数组中某个属性为某个值的 元素.并不是要去 for 循环. 要是改了之后,他们用 for 循环. 可以提议换一批人了. 前端也得进步, 而不是 for 循环走天下啊..

---------------------------------------------------

不规范，很别扭，改成数组好点

---------------------------------------------------

@simonCN 就事论事讨论就行，没必要说这些毫无意义的话。

---------------------------------------------------

JSON object 是一个 map/dict ，但是很多后端在处理上希望它是一个 class/struct 的对象。类似的问题还有无法区分 { } 和 { "foo": null }

---------------------------------------------------

@zhangtest 明明可以简化，其他同事的数据处理的工作量的问题，你偏偏要按自己的方式来，你不想想你的数据到底是服务谁的，而且你现在根本没在讨论，只是让别人接受你的观点，我觉得你比其他人都累

---------------------------------------------------

数组

---------------------------------------------------

@M003 还有 PC ，兼容性都是要考虑的，我们 web 就不能用最新的技术。

---------------------------------------------------

你是不是写 php 的?

---------------------------------------------------

返回一个数组的结构更合理，map 关系应该由使用方来维护。

---------------------------------------------------

我仔细看了一下你问的问题：遇到这种问题要如何解决？

那我给出你一个答案：不管客户端和前端谁说的对，也不为了谁方便，按照大家给的建议来，也就是按照规范来。

---------------------------------------------------

@Desiree 我把例子说的清清楚楚，每一方的观点都写出来了，是你先入为主本身就带有敌对情绪看待这个问题，你应该也属于其中一方，所以只要有观点出现和你不一致，你就喊打喊杀的，何必呢？

---------------------------------------------------

认真回复的你是一条都不回复啊，还讲什么就事论事，后端写这样的接口我会怀疑为什么和这样的人做同事

---------------------------------------------------

@zhangtest es6 可以 babel 编译成 es5 的 
哪怕没脚手架直接引个 es5 的 polyfill 的 js 进来也是没什么代价的
这个很难作为理由

---------------------------------------------------

我是前端。要是有人直接 obj['SKU_铅笔']。会被我喷。

---------------------------------------------------

你后端用什么语言写的？后端弱类型？不会直接拿 map 返回吧？我觉得该抱怨你的是其他后端吧。

---------------------------------------------------

这个问题没有讨论的必要。觉得这样好用的建议转行。

---------------------------------------------------

就没见过你这么嘴硬的

---------------------------------------------------

@Pastsong 没回复的有些是我认同就没必要追问，比如 15 楼的回答，有些是没意义懒得扯，比如 39 楼，你不要老是恶意揣度别人。

---------------------------------------------------

从语义和语用上来讲，第一层多出来的这个 key 莫名其妙又冗余。
从开发管理上来讲，设计不严谨的数据结构给静态强类型语言带来的麻烦（预定义数据结要考虑 key 的各种可能变化），远大于设计严谨的数据类型给弱类型、动态类型语言带来的麻烦（多写一些不容易出错的常规代码，其实善用函数式的话也不多）。

---------------------------------------------------

原生 app 开发的话，这种键名很难转成 model ，要额外写很多代码。。因为你觉得是数组，但是实际上在 json 里解出来是个对象。。。

我也是之前自己学着写客户端的时候，有些接口图方便写成这样，发现客户端这么用很难受的。干脆直接正常数组返回就好。

---------------------------------------------------

菜

---------------------------------------------------

“不用讨论这个没有意义，公司以结果为导向，做的项目运营稳定，客户满意就行，他们不会去看你代码。”

BB 啥呀，就知道和网友犟，你咋不直接把这段话发给你同事？

---------------------------------------------------

@jdkxnktkdkxod 一个简单的技术沟通为什么要上升到人身攻击？所有人都顺从你才是天理？你算个啥？

---------------------------------------------------

@daimubai 我发什么要你审批吗？如果不需要你也别 B B ，我懒得看。

---------------------------------------------------

用数组 这东西还需要讨论吗

---------------------------------------------------

因为强弱类型的问题，建议楼主赶紧改。真不建议把有实际意义的东西当做 key 来使用，schema 校验都不好验。

---------------------------------------------------

@daimubai 就因为你这一类烂人太多，什么事情都上纲上线，最终搞的正常交流都绝迹。

---------------------------------------------------

最主要的应该是 ios 和 android 大部分视图 View 组件是传 List 进去的，比较固定死板(当然可以改造)，因此 Map 类型的 Json 结果需要转换成 List 。

而 web/小程序是前端，写的直接就是 View 层了，因此比较宽泛，什么接口格式 for 就行了。而 ios 和 android 的比较固定，需要转换一次。

若 web/小程序开发者也不讨厌 List Json ，那就统一 List 好了，总之让那些呱噪的嘴闭上就行~~

---------------------------------------------------

不知道 OP 后端用的什么语言。
我个人是 java 角度，强类型语言偏向于建模，所有字段都是编码的。如果 op 也是 java ，我理解的实现方式就是 Map 用中文做 key 。
如果前端是弱类型如 js ，那好办怎么接都行。如果前端是强类型，那他们也得用 Map 接参，可能还得作一层前端的类型转换。

说在最后：我觉得后端自己本身也应该对自己代码有点追求，不到实在没办法，大可建模设计一下，尽量不要用中文变量。

---------------------------------------------------

前后端都做的路过
很明显类似"SKU_铅笔"，"SKU_书本"之类名称是不固定的，随时可能会变动，通过 key 查找是给自己找麻烦
如果是前端调用，反正都得遍历，单纯遍历 JSON 数组显然方便得多，搞成这样让人平白多写几行代码，被吐槽几句很正常
如果是后端调用，返回这种不固定 key 的格式，后端反序列化再调用会比前端麻烦得多，这就容易招骂了

---------------------------------------------------

@zhangtest #52 可能你不知道 JavaScript 是最追求新特性的语言，所有的高级语法、特性 90% 都可以由低版本语法模拟，有什么理由不用最新技术？

---------------------------------------------------

公司没有技术方面的领导吗...叫领导来决策吧。

---------------------------------------------------

@enpitsulin 给你说个案例，我们有个客户浏览器版本是 Chrome/79 ，打开页面白屏不兼容，我们最终不是叫他更新浏览器，而是下一个对应的浏览器优化兼容，这种情况听到“最新技术”都是心惊胆战。

---------------------------------------------------

@zhangtest #71 就你这狗嘴还有脸说正常交流，不知道哪个狗窝出来的

---------------------------------------------------

作为一个后端，看到这个返回的数据格式，尴尬癌犯了

---------------------------------------------------

@juzisang 我就是啊，所以才问问综合解决方案，结果遇到一堆上纲上线的烂人，不过也有些回答参考意义很大。

---------------------------------------------------

你这个 key 真的不应该，规范的 key 应该是稳定的、可预测的，根据内容来变的 key 是真的不合理。

---------------------------------------------------

@daimubai 外网匿名给了你为所欲为的口交，可是，谁 JB 理你呢？撒泡尿照照自己，看看是个什么东西。

---------------------------------------------------

盲猜你是写 PHP 的吧？应该也没写过 Go 或者 Java ，那就不奇怪了

---------------------------------------------------

不知道是啥后端，反正作为辣鸡 javaer 表示这种返回确实属于恶心人。
key 一般就是单纯 key ，作为字典或者其他值可以，极少把业务内容作为 key 放的。既然是 json ，关键是既然要前端识别 sku 后别的数据，那为啥不直接放一个属性，让前端直接取呢，属于让前端脱了裤子放屁了。

---------------------------------------------------

@zhangtest #78 我只能说前端技术不到位，至少在 JavaScript 这门语言上，兼容 IE6+ 的浏览器难度是很低的

---------------------------------------------------

https://pantao.gitbooks.io/coding-standards/content/json.html

---------------------------------------------------

找个 JSON 规范看看吧...

---------------------------------------------------

逆天后端，写这么个东西就不要怪挨骂

---------------------------------------------------

@chantaldzl 你先看看 28 楼的原始需求。

---------------------------------------------------

@enpitsulin ie 都亡了，还兼容 ie ，放过 ie 也放过自己吧。

---------------------------------------------------

@idealhs 没有人骂，现在是满足哪一方的问题。

---------------------------------------------------

@oamu 别这么说，银行内部很多系统还只支持 IE6

---------------------------------------------------

@zhangtest #78 你这个数据结构和兼容性有啥关系，退一万步说，前端不能直接用 find fiter 这种现成的 api 来查找数组中某一项，那自己通过 for 循环封装一个查找方法不就完事了。再说这也是前端要处理的事，你不需要考虑。

---------------------------------------------------

@zhangtest #92 看了你前面的回复，你这个领导觉得开心就好。你们的业务量达不到让你们感受到技术债务的程度的话，当个天真的傻子也挺好，谁还不是糊弄事儿呢。

---------------------------------------------------

商品列表展示没有分页没有排序吗，如果只是极少量的数据那随意怎么做了，如果要做分页排序就得用数组

---------------------------------------------------

这个结构没法模型化，只能当字典处理。编译型语言这种 key 是没有提示的，脚本型可能会有提示。这就是差异。

---------------------------------------------------

这个 key 看起来像是一个可能会出现重复值的 key,如果有重复那就完蛋. 如果使用方不需要这种结构, 这个 key 就是毫无意义的冗余. 会让其他前后端接手的人员看起来不是很明白这个 key 设计的用意.
个人更倾向于直接给结构数组, 使用方想要什么 key 组合成 map 他自己处理放到他那边内存里用

---------------------------------------------------

看见 `中文+不能直接读的单词` 我们公司是直接否决掉的，不符合要求。
如果是特殊行业，比如：国家最高检大数据这种，故意用中文和不可读字符的话那另外算，没办法改。

---------------------------------------------------

@thomaswong025 你刷新下看看原始需求，他就是要重新整理数据，key 是主键不会重复。

---------------------------------------------------

@iOCZ 你说对了，他其实就是“字典”，取对应记录，和普通数组不同。

---------------------------------------------------

@george2077 同意 6 楼的这种写法，楼主的写法跟我这边的后端一模一样，作为前端，个人是很不喜欢的

---------------------------------------------------

@gaocc 是的，这种情况不是普遍性，是迫不得已。

---------------------------------------------------

说实话这接口我写不出来,我也不敢给前端这种格式.
你为啥不把这也当成个属性,然后返回个数组

---------------------------------------------------

这个要分页怎么办。

---------------------------------------------------

我一直觉得这种东西不配叫 JSON

---------------------------------------------------

@idealhs 遇到文明讲道理的人我会认真回复，有些不回复的是因为我认同。遇到烂人我也不怕，这些年来接触招聘各种开发程序员，阅人无数，我有足够的办法应对这些烂人。

---------------------------------------------------

@knva 他就不是一个数组，更不会分页，前面有人回答了，他更适合是一种“字典”。

---------------------------------------------------

键名有中文我一个 web 前端是不能接受的

---------------------------------------------------

写这样接口的后端 让他卷铺盖走人吧。别霍霍人了

---------------------------------------------------

@zhangtest #90 不管什么需求不发规范就是不规范

---------------------------------------------------

前后端都写过，app 也做过；如果为了交差，那无所谓的，委屈一下移动端的同学，不过作为一个曾经移动端的开发，想给我这种结构的后端同学已经被我给取代了；如果考虑后续维护就返回数组吧，不给自己和接手的朋友添麻烦；我理解真正的后端应该不单单只是出接口，你出的应该是一套规范，不是一方说简单就确定的，要对自己的规范负责的；

---------------------------------------------------

多规格前端一般都用矩阵来处理，这种数据拿到手还是要重新过滤一遍

---------------------------------------------------

@yummy007 已经有人认真看需求说到根本上了，这不是数组，他就是字典。

---------------------------------------------------

扩招的后果，有些人天生不适合 coder 这个岗位

---------------------------------------------------

我盯了半天都没看懂争论的啥，直到刚才突然顿悟。。。。    
参考我写自己一个人写蜃境（ https://www.v2ex.com/t/965435  ）过程中的实际体验（后端 go 、前端 VUE js 、客户端 Windows Go+walk 、客户端 iOS Swift+SwiftUI+Go…）我的想法列举如下：       
    
1 、不管怎么说，key 使用中文确实不大好；    
2 、对于像 go 、js 这样 map 友好的，写成 k-v map 确实索引会省事些；    
3 、一些语言中，当 key 是字符串且是动态（即编码时不确定全部值的种类，或者种类特别多的）时，json 解析成对象时会难很多；    
4 、3 中难度增加是要大于 2 中带来的便利的；     
5 、如果各端都是一个人写（像我前面提的那样），就找个自己舒服的姿势好了，大概率会切成数组避免在对 map 不友好语言中的麻烦；     
6 、如果是团队搞的话，就靠领导拍板就好了，看哪方不顺眼就让那一方多费点劲。

---------------------------------------------------

客户端和前端的爱好不一样
比如 post 请求只有 1,2 个参数的时候, Android/iOS 喜欢走 www-form-urlencoded, 但是前端还是要走 json 的

---------------------------------------------------

换个后端可解

---------------------------------------------------

如果你这种数据结构是填充到列表的，怎么去确定先后顺序？

---------------------------------------------------

直接按按数组返回就行了，不然客户端手解 json 既麻烦还容易出 bug
需要字典前端完全可以自己整理，过一个 fold 的事

---------------------------------------------------

老哥已经有最优解了，就是数组对象的方式，通吃

---------------------------------------------------

接口的问题

---------------------------------------------------

@gps949 感谢你的整理，这个不是正常数组，不用分页循环，他就是一个字典一样的 json ，取对应的值，中文是迫不得已的，没字段可以按照要求分类了。

---------------------------------------------------

可以,但是不规范,会导致代码维护成本上升

---------------------------------------------------

不是数组的话这么返回也行吧，key 最好换成英文的。

---------------------------------------------------

对象套对象，很恶心，甚至还有中文内容

---------------------------------------------------

这是伪装萌新的钓鱼贴吧？！，居然还有人一本正经的解答...如果是真实的，那我感觉这个应该是文科生转码参加了诸如“创业夏令营”之类的活动...

---------------------------------------------------

@xuxu5112 如果是我们自己定的可以固定英文，但是很多时候对接的第三方，就算他们大小写等风格和我们不一样我们也不会改他们的字段，原始返回给前端，尊重别人命名，也方便排查问题。中文如果迫不得已用到了，只要不影响结果也会用，不会特意去映射一下成英文。

---------------------------------------------------

@seasonsolt 中国还是好人多点，像你这一类心理阴暗的烂人只是少数。

---------------------------------------------------

小公司估计这样无所谓了，规范一点的公司会被喷死

---------------------------------------------------

只能说 OP ios 、android 端的人有点代码追求。因为稍微有点代码追求的人，都不会接受这样的数据结构 QAQ

---------------------------------------------------

兄弟 你是后端 你知道 class 吧，安卓 iOS 都是根据 json 来生成 class 对象 然后通过操作 class 对象来取值赋值的，你这样搞 json 每个 sku 的类型不同，json 的 key 就不一样，安卓 iOS 的兄弟所有的都只能是通过 map 来取值了，就没有面向对象的概念了。

---------------------------------------------------

@KKKKKKKKKKKKKKKK 他追求不追求代码质量没人在意，公司只看结果。你可以想想，你做那么多项目，老板、客户会看你代码吗？他要的是结果。

---------------------------------------------------

你这只有一层，Android 和 iOS 还能凑合着解析，要是

---------------------------------------------------

@qq2511296 问题原因已找到，这不是个数组，就是个普通字典 json 。

---------------------------------------------------

key 写成中文如果我是前端可能会骂人

---------------------------------------------------

你这只有一层，Android 和 iOS 还能凑合着解析，要是下面这种格式：{
	"SKU_铅笔": {
		"q1": 123,
		"sku": "SKU_铅笔"，

	},
	"SKU_书本": {
		"q1": 456,
		"sku": "SKU_书本"
	}
}

---------------------------------------------------

说到底不就是前端不愿意自己把 slice 转换成 map 吗？其实是后端转换了一遍把。存储的时候难道是 map 格式存吗。这种情况可以抽象一个统一转换方法，或者 lodash 可以把（没写过前端听过）。你迎合了前端就很难迎合移动端。

---------------------------------------------------

@bloodspasm 以我们做的项目情况来看，基本不会维护以前接口，都是持续不断更新迭代新功能，尽量不会去改以前的接口，遇到实在要改的为了兼容都会重新写一个。

---------------------------------------------------

打个回车好难。。。SKU_铅笔" 中要是还嵌套一层 map ，更恶心。主要是你这不符合 json 的规范，特别对强类型语言都是围绕规范设计的，你弄个不合规的别人当然觉得恶心，你用用强类型语言就理解了

---------------------------------------------------

@choochoofly 理解错了，这不是一个正常数组结构，他就是个字典 json ，前端知道 key 直接取值就行。

---------------------------------------------------

不要说了，不管历史原因是什么，只要有人需要修改这块代码，但是还继续用 SKU_铅笔，这种 key 的话，要么不负责任，要么就是项目做少了

对于可能会变动的数据，用来做 key 就是有问题的，变动包括 改名，增加，减少

你这个结构，加了 key 怎么办？比如 SKU_2B 铅笔？，如果减少，比如没有 SKU_铅笔，前端 直接 obj[key]不也有问题么？
后端只要是一对多，就应该考虑所有端包括语言特性

后端返回数据的最基本要求就是，结构不要变，你这种 如果 SKU_少了一个或者多了一个，就算结构变了，可能你后端是弱类型的语言，但是 同一个接口，返回不同的结构，就是后端的问题！

---------------------------------------------------

在数据库表中 SKU_铅笔 没有对应的 key ？难道 SKU_铅笔 就是 key

---------------------------------------------------

这数据结构真的好像我一同学在的公司接的接口，也刚好是展示商品的。
作为一个 web 前端，虽然 obj['xxx']是很爽，不过还是不怎么能接受键存放数据和中文的情况。

---------------------------------------------------

@choochoofly 没有，这是项目上线很久了，产品根据客户反馈突然提的需求，只能根据明细去整理成一个新 key 做主键统计。

---------------------------------------------------

@zhangtest 如果你以老板，以公司的角度来考虑这个问题，那这个帖子发的毫无意义

---------------------------------------------------

作为前端,没人跟我一样对于未知的 obj['xxx']是很恐惧的吗

---------------------------------------------------

只要是列表就应该用数组，对象的顺序不可控。from 前端

---------------------------------------------------

@zhangtest 
但是我看你描述:
 `商家有很多商品`你用一个 obj 返回很多商品让前端去处理是否合理? 
就像列表一样如果很多商品你会去分页完成才是合适的. 
如果拆分位两个接口一个列表一个是详情是否更合适.

---------------------------------------------------

1 、不符合规范，哪怕是作为字典。字典的要求是双方都知道 key 有哪些，key 变动了 iOS/Android 又要更新一次吗？
2 、你不是来找解决方案，你是来找认同，然而好像没看到认同你的。
3 、领导只看结果不关注代码，没必要来这里发，你的领导在你公司。

---------------------------------------------------

@QlanQ 结构会变，但是前端已经提前能拿到所有 key ，他根据 key 取详情，没取到就不展示，这就是个普通字典 json 。

---------------------------------------------------

@ttvv123 
1 、有个前提，就是前端已经提前知道 key 是多少。
2 、不用怀着阴暗的一面揣测别人，没意义。
3 、去哪发展是个人的选择，没有标准，更不需要你定标准。

---------------------------------------------------

@zhangtest 

既然本身数据维度就属于 spu 套 sku ， 那后端本身数据结构就已经是含有 spu_id 了， 你们的后端实际已经做了我的范例 1 所表述的数据结构的查询，只是没有展示 spu_id 而已，所以完全可以做成我说的方式一的树，都不需要改多少代码。

最后，我表达的含义仅仅是我不喜欢，并不代表你们 pc 他们指定的格式不可以使用,  好的数据结构的设计里面，key 就应该只是代表某种结构属性，而不应该是某个业务值。

{ "property1" : "value1", "property2" : "value2",}  √
{ "some_val1" : "value_2", "some_val3" : "value_4"}  ×

{"id":1, "name": "张三", "age": 18} , {"id":2, "name": "李四", "age": 16}  √
{"张三": 18, "李四": 16}  ×

吃饭选择用碗盛出来放到桌子上，然后用筷子吃，或者直接拿个叉子站在灶台边从锅里挑着吃。你问我后一种方式能不能吃，我会说能，但我更喜欢前一种方式， 而你们的 ios 和安卓端无法接受，所以反对站在锅边吃。从物理意义上晏子还能从狗洞钻进城呢，但应该吗？而你我发现实际是站在方案 1 的立场来指责别人的。

---------------------------------------------------

@bloodspasm 没有分页，商品也不多，这个接口返回的数据就是取详情，不需要遍历。

---------------------------------------------------

好像骂人啊，疯狂告诉自己生气，画个圈圈诅咒 op

---------------------------------------------------

@zhangtest 原来从根上就是坏的，当时加的太随意了。从工作量和可维护上来说你把它转成 list 给 Android 和 iOS 比较好，当然你保持原样也行，除了 android 和 ios 难受，没人在乎，虽然我是 Android 开发 😂

---------------------------------------------------

@zpf124 我们是调的第三方，只能在第三方的数据基础上完成需求，如果自己设计就不会有这些问题，怎么来都行。

---------------------------------------------------

@zhangtest 你只能说前端已经提前拿到，目前为止所有已知的 key ，后续变更呢，如果是删除呢？比如 SKU_铅笔 没有了，你是没有这个 key 还是 key 下面是空？这数据结构不就变了吗？

---------------------------------------------------

钓鱼贴，终结

---------------------------------------------------

@QlanQ 后续变动前端也能拿到，前端前置数据是请求了个第三方接口，第三方刚好返回了这个主键 key(包含中文)，然后根据这个主键 key 查询我们统计的一些数据。

---------------------------------------------------

作为前端，这种结构看起来也觉得有点奇怪。 前端做下 indexBy 其实很快的。你作为后端，只管描述准确的数据，以及方便扩展。客户端方便与否不是重点。

有些时候，页面需要的结构很复杂，需要经过很多次关联、计算才能得出。那这种级别的“麻烦”你可以在服务端处理掉（当然，也可能是太复杂了需要离线计算写入，然后服务端只是查询转发下结果），然后根据结果的结构约定一个新的“类型”返回给客户端。

---------------------------------------------------

以前我还会和后端叨叨这些，现在只是提一嘴，反正又管不了后端。代码难维护，不是显得我重要吗😏

---------------------------------------------------

@zhangtest  
1 、知道了现在所有的 key 有意义么？业务是会变的。变动了以后还不是要更新。
2 、这是对你行为的总结，不是阴暗的揣测。讨论了有两页，无论前端后端都提出来这个方案能用，但不太好。你的反应是：领导觉得好就好。
3 、我说的是发帖，你说的是发展，就很难。。。

---------------------------------------------------

@zhangtest #133 我跟你说，不要写这种“字典”了，写这种“&=请选择&1=已婚&5=未婚&2=离婚&6=丧偶”让前端拿字符串自己玩去吧

---------------------------------------------------

我是前端： 一开始我会叫后端转成数组， 后面，我都自己转，无所谓。

---------------------------------------------------

转换成 list 很难吗？无论哪个端都能处理。你这样设计，在 IOS 和安卓的角度处理都很麻烦。这么多人说了这种不太好，还觉得自己的方案最完美，沟通毫无意义。

---------------------------------------------------

@zhangtest 那就是你们的第三方的问题，或者你们没有找到合适的接口，而且既然是第三方那就好办了，
既然 pc 觉得这个接口很好那就用这个， 
ios 和安卓觉得不好，那就让他们根据 spu 列表接口和 sku 列表接口自己做聚合，或者你们后端写一个包装接口做聚合，自己构建符合规范的树形结构。

如果你们的第三方连聚合需要用的两个接口都没有，那这第三方代码真是稀烂，如果你们权威大就逼着他们给个合适的接口，如果人家权威大那你们还争论这个干什么，说的好像有得选似的，该吃屎的时候就只能吃。

---------------------------------------------------

这样定义接口会被如果在我司，会被前端质疑后端能力

---------------------------------------------------

@ttvv123 
1 、要结合实际场景看待这个 key 的问题，160 楼说了。
2 、我已经被驯化成就是这个态度：领导客户觉得好就是好。
3 、去哪发帖是个人的选择，没有标准，更不需要你定标准。

---------------------------------------------------

某一天老板说我们项目要支持多语言
要整 i18n

---------------------------------------------------

@tog 工作内容上加一句：处理后端不规范数据😏

---------------------------------------------------

很简单的道理嘛，前端 post 给你的是这样的你能接受吗？

---------------------------------------------------

@liuhuan475 人的悲欢并不相通，公司之间也是一样，我们只会根据实际情况去解决问题，不会去怀疑谁，我们人多也不需要去怀疑个人，我相信聪明的人不会只在你们公司。

---------------------------------------------------

@syubo2810 我们有些业务确实让前端按照这种 key->value 的格式整理了数据传过来了，不但接受还感激。

---------------------------------------------------

从代码质量角度来说应该修改。从小组工作来说，正常的大多数人都喜欢的东西你强制修改其实并不好。尤其是互联网业务，这个东西可能三个月后推倒重做，怎么实现和实现速度，肯定是速度更重要。

---------------------------------------------------

很菜很恶心

---------------------------------------------------

@zpf124 你说对了，公司还能运营就是一直在吃屎，各方都不能得罪，能自己吃的绝对不会让别人吃，别人也不会吃还自讨没趣。

---------------------------------------------------

@xomix 有你这种认知的人很少，大多数人只喜欢站在自己角度看问题，而不是实际情况是怎么样的，像目前我们遇到的问题，上线很久了，牵扯太多还不能随意改动。

---------------------------------------------------

有个很简单的办法, 你试试写一下这个接口的接口文档, 定义 response 的参数.
用数组是可以写出来的; 用你这样, 你的文档会非常非常长, 每个 key 都要列出来.

---------------------------------------------------

我都不敢想象"skuObj. SKU_铅笔"这种写法出现在代码里，会丑死我的

---------------------------------------------------

@zhangtest 你单独给 ios 做一套翻译输出吧，你不会说 api 调用输出没有做统一出口吧？

---------------------------------------------------

@zhangtest 你这怎么解析啊，key 乱变的啊

---------------------------------------------------

@enpitsulin IE6+，我不知道你做过没有，我做过 IE8+的项目，你觉着很轻松，那我只能说我很菜，反正我的经历告诉我兼容 IE10 以下的浏览器都是非常痛苦的

---------------------------------------------------

@syubo2810 你看看 160 楼，key 乱变前提是前端已经知道结果 key ，他根据 key 才从这个接口数据拿更多数据。

---------------------------------------------------

js php 弱类型语言使用这种接口，如果不需要排序的话，确实省点事。比如要显示某个 sku 的数量，直接 data[sku] 就完事了。如果是数组，需要获取到接口数据后再转为 这种类型。

但对强类型语言，比如 object-c java 等，这真是有点太反人类了。

综合来说还是返回数组[]比较合适，毕竟 pc 、小程序对数组处理下，转为自己需要的格式，要比 ios 前端处理容易的很多。

---------------------------------------------------

@xomix 再怎么考虑速度，也得有个正常的规范 & 编程认知吧。。。谁不想把代码写好？

---------------------------------------------------

@wyhooo 就一个简单的工作，别太理想化了，能做自然是好的，但是大家已经这么做这么久了，你要掀桌子你看看大家怎么对你

---------------------------------------------------

@haha512 客观公正，往下说还要评估很多东西，像 PC 小程序是提前做好上线了的，APP 后续补上来，要改的话要一起改，还得结合实际业务场景，看看是不是真需要改或者有其他方式解决。

---------------------------------------------------

@zhangtest web 端同意你的看法是有原因的，因为 web 端可以根据你数据的改变随时发版解决。客户端怎么解决呢？
如果一个 key 被删除了，导致客户端预期之外的结果。这锅你背？你考虑新老版本兼容问题了吗？

---------------------------------------------------

你可以把接口改成这样的, 谁都能用

{
	"SKU_铅笔": {
		"q1": 123,
		"sku": "SKU_铅笔"
	},
	"SKU_书本": {
		"q1": 456,
		"sku": "SKU_书本"
	},
	"AppData": [
		{
			"q1": 123,
			"sku": "SKU_铅笔"
		},
		{
			"q1": 456,
			"sku": "SKU_书本"
		}
	]
}

---------------------------------------------------

我建议改成数组，让客户端自己对数据进行加工

---------------------------------------------------

取值一时爽，维护火葬场

---------------------------------------------------

@zhangtest 这么搞以后代码很难维护的，虽然大部分项目最后会变屎山，但你们这么搞开始就是了...

---------------------------------------------------

@zhangtest  那就在 return 地方加个适配，如果是 app 的话，直接转为 正常 list 就行了，pc 小程序不需要动。

---------------------------------------------------

@liuhuan475 你先看看 160 楼，结合实际业务场景。

---------------------------------------------------

@zhangtest js 前端可以在数据进入的地方统一转换到他自己喜欢的任何内部格式，并没有增加多少工作量。

---------------------------------------------------

@syubo2810 看看 190 楼，维护这个问题有自己的经验总结，目前这一套经验搞了很多年，很流畅。

---------------------------------------------------

@syubo2810 说错了，是 139 楼。

---------------------------------------------------

@zhangtest 看了，我真不知道说啥好了...
规范开发你会发现后面要写的代码会一点点少起来，开发效率能上去很多，还是建议规范开发

---------------------------------------------------

@zhangtest 没有兜底方案的吗？三方拿不到你们 APP 就不能用了？

